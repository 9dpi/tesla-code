<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MẬT MÃ TESLA | THẦN SỐ HỌC VŨ TRỤ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y6C1MRYC9X"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-Y6C1MRYC9X');
    </script>
    <style>
        :root {
            --tesla-accent: #00f2ff;
            --accent-rgb: 0, 242, 255;
            --bg-deep: #05070a;
            --card-bg: #11161d;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
            appearance: none;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: var(--bg-deep);
            color: #fff;
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        body,
        .glass-card,
        .btn-primary,
        .tesla-card-small,
        h1,
        h2,
        input,
        .reading-box {
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .app-container {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            z-index: 10;
        }

        .glass-card {
            background: var(--card-bg);
            border: 1px solid rgba(var(--accent-rgb), 0.2);
            border-radius: 30px;
            padding: 35px 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
        }

        h1 {
            font-size: 1.2rem;
            letter-spacing: 5px;
            color: var(--tesla-accent);
            margin-bottom: 30px;
            font-weight: 300;
        }

        .label-tiny {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: rgba(255, 255, 255, 0.3);
            margin-bottom: 15px;
            display: block;
        }

        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .input-row input {
            background: #000;
            border: 1px solid #222;
            border-radius: 12px;
            color: var(--tesla-accent);
            font-size: 1.3rem;
            width: 100%;
            text-align: center;
            padding: 15px 0;
            outline: none;
        }

        .input-row input:focus {
            border-color: var(--tesla-accent);
            box-shadow: 0 0 15px rgba(var(--accent-rgb), 0.2);
        }

        .gender-switch {
            display: flex;
            background: #000;
            border-radius: 50px;
            padding: 4px;
            border: 1px solid #222;
            margin-bottom: 35px;
        }

        .gender-btn {
            flex: 1;
            padding: 12px;
            cursor: pointer;
            border-radius: 50px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.4);
        }

        .gender-switch input {
            display: none;
        }

        .gender-switch input:checked+.gender-btn {
            color: #000;
            font-weight: bold;
            background: var(--tesla-accent);
            box-shadow: 0 0 15px var(--tesla-accent);
        }

        .tesla-card-small {
            width: 120px;
            aspect-ratio: 1/1;
            background: radial-gradient(circle at center, rgba(var(--accent-rgb), 0.15) 0%, #000 100%);
            border-radius: 20px;
            border: 1px solid rgba(var(--accent-rgb), 0.3);
            margin: 0 auto 20px auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 10px;
        }

        .card-num-small {
            font-size: 3rem;
            font-weight: bold;
            color: var(--tesla-accent);
            text-shadow: 0 0 20px var(--tesla-accent);
            margin: 0;
        }

        .reading-box {
            background: rgba(var(--accent-rgb), 0.05);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: left;
            font-size: 1rem;
            line-height: 1.7;
            border-left: 4px solid var(--tesla-accent);
            color: #eee;
            min-height: 220px;
            display: flex;
            align-items: flex-start;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .qr-container {
            display: none;
            width: 100%;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        .qr-image {
            width: 100%;
            max-width: 200px;
            border-radius: 10px;
            border: 2px solid var(--tesla-accent);
            margin-bottom: 15px;
        }

        .back-link {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--tesla-accent);
            text-decoration: underline;
            cursor: pointer;
            display: inline-block;
            margin-top: 10px;
            letter-spacing: 1px;
        }

        .btn-primary {
            width: 100%;
            padding: 18px;
            border-radius: 50px;
            border: none;
            background: var(--tesla-accent);
            color: #000;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(var(--accent-rgb), 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .btn-row {
            display: flex;
            gap: 10px;
            justify-content: space-between;
            margin-top: 10px;
        }

        .btn-outline {
            flex: 1;
            background: transparent;
            border: 1px solid #333;
            color: #fff;
            padding: 12px;
            border-radius: 50px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: 0.3s;
        }

        .hidden {
            display: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>

    <div class="app-container">
        <div id="scr-1" class="glass-card">
            <h1>TESLA CODE</h1>
            <span class="label-tiny">Mật mã ngày sinh</span>
            <div class="input-row">
                <input type="number" id="d" placeholder="DD" inputmode="numeric" min="1" max="31">
                <input type="number" id="m" placeholder="MM" inputmode="numeric" min="1" max="12">
                <input type="number" id="y" placeholder="YYYY" inputmode="numeric" min="1900">
            </div>
            <span class="label-tiny">Bản thể năng lượng</span>
            <div class="gender-switch">
                <label style="flex:1"><input type="radio" name="gen" value="NAM" checked>
                    <div class="gender-btn">NAM</div>
                </label>
                <label style="flex:1"><input type="radio" name="gen" value="NỮ">
                    <div class="gender-btn">NỮ</div>
                </label>
            </div>
            <button class="btn-primary" onclick="toStep2()">KÍCH HOẠT TẦN SỐ</button>
        </div>

        <div id="scr-2" class="glass-card hidden">
            <div style="font-size: 4rem; color: var(--tesla-accent); font-weight: bold; text-shadow: 0 0 20px var(--tesla-accent);"
                id="out-num">0</div>
            <h2 id="out-title"
                style="color:var(--tesla-accent); font-weight: 300; margin: 5px 0 20px; font-size: 1.1rem;"></h2>
            <div class="hint-box" id="out-hint"
                style="background: rgba(var(--accent-rgb), 0.03); border-radius: 20px; padding: 20px; margin: 20px 0; text-align: left; font-size: 0.9rem; border-left: 4px solid var(--tesla-accent);">
            </div>
            <hr style="border: 0; border-top: 1px solid #222; margin: 25px 0;">
            <span class="label-tiny">Con số bạn ấn tượng nhất hôm nay?</span>
            <input type="number" id="ins-num"
                style="background:#000; border:1px dashed var(--tesla-accent); color:#fff; width:100%; padding:18px; border-radius:15px; text-align:center; margin-bottom:25px; font-size:2rem; outline:none;"
                placeholder="">
            <button class="btn-primary" onclick="toStep3()">GIẢI MÃ THẦN SỐ</button>
        </div>

        <div id="scr-3" class="glass-card hidden">
            <div id="capture-area" class="tesla-card-small">
                <h1 class="card-num-small" id="card-num-final"></h1>
                <div id="card-status"
                    style="font-size:0.5rem; letter-spacing:1px; color:var(--tesla-accent); margin-top:5px; text-transform:uppercase;">
                </div>
                <div style="font-size: 0.5rem; opacity: 0.5; margin-top: 5px;" id="res-ins"></div>
            </div>

            <span class="label-tiny" id="reading-label" style="text-align: left; display: block;">Thông điệp từ trạm
                phát Tesla</span>

            <div class="reading-box">
                <div id="ai-reading-content"></div>
                <div id="qr-display" class="qr-container">
                    <p style="font-size:0.7rem; margin:0 0 10px 0; color:var(--tesla-accent);">Cảm ơn Nhà Kiến Tạo đã
                        nạp năng lượng</p>
                    <img src="https://lh3.googleusercontent.com/d/1egscXEcGdy9sR3pm13RlO1gZQMLdqdjF" class="qr-image"
                        alt="QR Donate">
                    <div class="back-link" onclick="toggleQR(false)">← QUAY LẠI LUẬN GIẢI</div>
                </div>
            </div>
            <div
                style="font-size: 0.78rem; color: rgba(255,255,255,0.5); text-align: justify; line-height: 1.6; margin: 20px 0 30px 0; padding: 0 5px; letter-spacing: 0.3px;">
                <b
                    style="color: var(--tesla-accent); opacity: 0.9; letter-spacing: 2px; display: block; margin-bottom: 8px; text-align: left;">TRIẾT
                    LÝ VẬN HÀNH</b>
                Vũ trụ được vận hành bởi những mật mã toán học tinh vi. Pythagoras và Nikola Tesla tin rằng mọi rung
                động đều có thể mã hóa thành con số. Hệ thống này phân tích tần số ngày sinh của bạn (Gốc rễ) kết hợp
                với chỉ số bắt gặp tức thời (Biến số) để xác định điểm rơi năng lượng trong không gian. Đây không phải
                là bói toán, mà là sự giao thoa giữa toán học cổ xưa và trí tuệ nhân tạo, giúp bạn thấu thị bản thân và
                làm chủ mọi biến số trong dòng chảy thời gian.
            </div>

            <button class="btn-primary" id="btn-nap-pin"
                style="background: linear-gradient(45deg, var(--tesla-accent), #fff); color:#000;"
                onclick="toggleQR(true)">NẠP PIN VŨ TRỤ</button>

            <div class="btn-row">
                <button class="btn-outline" onclick="downloadCard()">LƯU CARD</button>
                <button class="btn-outline" onclick="shareApp()">CHIA SẺ</button>
            </div>

            <p onclick="location.reload()"
                style="font-size:0.6rem; margin-top:30px; opacity:0.3; cursor:pointer; letter-spacing:2px;">KHỞI TẠO LẠI
            </p>
        </div>
    </div>

    <script>
        const themes = {
            2: { c: "#E0E0E0", rgb: "224, 224, 224", t: "Người Kết Nối", h: "Trực giác là vũ khí mạnh nhất của bạn." },
            11: { c: "#E0E0E0", rgb: "224, 224, 224", t: "Người Truyền Cảm Hứng", h: "Tần số tâm linh cao vượt bậc." },
            3: { c: "#FF8C00", rgb: "255, 140, 0", t: "Nhà Truyền Tin", h: "Sáng tạo là dòng máu chảy trong bạn." },
            5: { c: "#FF8C00", rgb: "255, 140, 0", t: "Kẻ Khai Phá", h: "Tự do là bản chất vốn có." },
            4: { c: "#FFD700", rgb: "255, 215, 0", t: "Người Kiến Tạo", h: "Sự vững chãi tạo nên di sản." },
            8: { c: "#FFD700", rgb: "255, 215, 0", t: "Người Điều Hành", h: "Quyền năng chuyển hóa vật chất." },
            6: { c: "#20B2AA", rgb: "32, 178, 170", t: "Nhà Kiến Tạo Tận Tâm", h: "Sức mạnh của sự chữa lành." },
            9: { c: "#20B2AA", rgb: "32, 178, 170", t: "Người Phụng Sự", h: "Cho đi là nhận lại trọn vẹn." },
            7: { c: "#00F2FF", rgb: "0, 242, 255", t: "Nhà Thông Thái", h: "Tĩnh lặng để thấu thị vạn vật." },
            10: { c: "#00F2FF", rgb: "0, 242, 255", t: "Nhà Lãnh Đạo", h: "Thích nghi chính là sức mạnh." }
        };

        const coreWisdom = {
            2: "Sức mạnh nằm ở thấu cảm. Tần số của bạn thu hút những kết nối tâm giao.",
            3: "Trí tuệ sáng tạo đang đỉnh cao. Dùng ngôn từ thắp sáng hy vọng.",
            4: "Kỷ luật là chìa khóa. Một nền móng quan trọng đang hình thành.",
            5: "Sự đổi mới đang gọi tên. Đó là dòng chảy của tiến hóa.",
            6: "Năng lượng chữa lành lan tỏa. Hãy dùng tình yêu làm kim chỉ nam.",
            7: "Tĩnh lặng mang lại câu trả lời. Bạn chạm tới ngưỡng cửa thông thái.",
            8: "Quyền năng vật chất hội tụ. Giữ tâm thế công bằng để đón thịnh vượng.",
            9: "Một chu kỳ khép lại cho đại lộ mới. Sự bao dung giúp thăng hoa tần số.",
            10: "Bản lĩnh lãnh đạo tiềm ẩn trỗi dậy. Sẵn sàng để tiên phong.",
            11: "Bạn là kênh dẫn ánh sáng tâm linh. Trực giác lúc này chính là mật mã."
        };

        const backupActions = ["Quan sát hơi thở và thực hiện một hành động tử tế vô điều kiện hôm nay.", "Viết xuống 3 mục tiêu lớn và bắt đầu ngay khi mặt trời mọc.", "Tắt thiết bị điện tử 30 phút để kết nối lại với bản thể thực thụ."];

        function applyTheme(n) {
            const theme = themes[n] || themes[7];
            document.documentElement.style.setProperty('--tesla-accent', theme.c);
            document.documentElement.style.setProperty('--accent-rgb', theme.rgb);
        }

        function calculate(d, m, y) {
            let sum = [...(d + m + y)].reduce((a, b) => a + parseInt(b), 0);
            while (sum > 11) sum = [...sum.toString()].reduce((a, b) => a + parseInt(b), 0);
            return sum;
        }

        function toStep2() {
            const dI = parseInt(document.getElementById('d').value);
            const mI = parseInt(document.getElementById('m').value);
            const yI = parseInt(document.getElementById('y').value);
            const currentYear = new Date().getFullYear();

            // VALIDATION RULE
            if (!dI || !mI || !yI) return alert("Vui lòng nhập đầy đủ mật mã ngày sinh!");
            if (dI < 1 || dI > 31) return alert("Ngày sinh không hợp lệ (1-31)!");
            if (mI < 1 || mI > 12) return alert("Tháng sinh không hợp lệ (1-12)!");
            if (yI < 1900 || yI > currentYear) return alert(`Năm sinh phải từ 1900 đến ${currentYear}!`);

            let n = calculate(dI.toString(), mI.toString(), yI.toString());
            applyTheme(n);
            document.getElementById('out-num').innerText = n;
            document.getElementById('out-title').innerText = themes[n].t.toUpperCase();
            document.getElementById('out-hint').innerText = themes[n].h;
            document.getElementById('scr-1').classList.add('hidden');
            document.getElementById('scr-2').classList.remove('hidden');
        }

        async function getTeslaReading(num, ins) {
            let apiKey = localStorage.getItem('tesla_key');
            const coreText = coreWisdom[num] || coreWisdom[7];
            if (!apiKey) {
                apiKey = prompt("Kết nối AI: Nhập API Key của bạn:");
                if (apiKey) localStorage.setItem('tesla_key', apiKey);
                else return `<b>Gốc thần số:</b> ${coreText}<br><br><b>Mật mã:</b> ${backupActions[0]}`;
            }
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
            const pText = `Đóng vai Tesla. Gốc thần số ${num}: "${coreText}". Dấu hiệu: ${ins}. Giải mã sự kết hợp và đưa ra 1 hành động thực thi trong 24h. Giọng bí ẩn, quyền năng. Tối đa 120 từ.`;
            try {
                const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: pText }] }] }), signal: AbortSignal.timeout(6000) });
                const data = await res.json();
                return data.candidates[0].content.parts[0].text;
            } catch (e) { return `<b>Gốc thần số:</b> ${coreText}<br><br><b>Mật mã hành động:</b> ${backupActions[Math.floor(Math.random() * backupActions.length)]}`; }
        }

        async function toStep3() {
            let ins = document.getElementById('ins-num').value;
            if (!ins) return alert("Hãy nhập con số khiến bạn ấn tượng!");
            let n = document.getElementById('out-num').innerText;
            document.getElementById('scr-2').classList.add('hidden');
            document.getElementById('scr-3').classList.remove('hidden');
            document.getElementById('ai-reading-content').innerHTML = "<i>Đang truy xuất bản ghi Akashic...</i>";
            document.getElementById('card-num-final').innerText = n;
            document.getElementById('card-status').innerText = themes[n].t;
            document.getElementById('res-ins').innerText = "#" + ins;
            const read = await getTeslaReading(n, ins);
            document.getElementById('ai-reading-content').innerHTML = read;
        }

        function toggleQR(show) {
            const reading = document.getElementById('ai-reading-content');
            const qr = document.getElementById('qr-display');
            const label = document.getElementById('reading-label');
            const btn = document.getElementById('btn-nap-pin');

            if (show) {
                reading.style.display = 'none';
                qr.style.display = 'block';
                label.innerText = "Năng lượng trao đi";
                btn.style.opacity = '0.3';
            } else {
                reading.style.display = 'block';
                qr.style.display = 'none';
                label.innerText = "Thông điệp từ trạm phát Tesla";
                btn.style.opacity = '1';
            }
        }

        function downloadCard() {
            const area = document.getElementById('capture-area');
            html2canvas(area, { backgroundColor: '#05070a', scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `TeslaCode-${document.getElementById('card-num-final').innerText}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        function shareApp() {
            const text = `Khám phá mật mã Tesla của bạn tại: ${window.location.href}`;
            if (navigator.share) navigator.share({ title: 'Tesla Code', text: text, url: window.location.href });
            else { navigator.clipboard.writeText(text); alert("Đã sao chép link!"); }
        }

        document.getElementById('d').oninput = function () { if (this.value.length == 2) document.getElementById('m').focus() };
        document.getElementById('m').oninput = function () { if (this.value.length == 2) document.getElementById('y').focus() };
    </script>
</body>

</html>
